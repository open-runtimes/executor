# Values for production deployment
replicaCount: 3

image:
  repository: openruntimes/executor
  pullPolicy: Always
  tag: "latest"

config:
  runner: "kubernetes"
  env: "production"
  runtimes: "php-8.3,node-21.0,python-3.12,deno-1.40,ruby-3.3,go-1.21"
  runtimeVersions: "v5"
  inactiveThreshold: "300"
  maintenanceInterval: "600"
  imagePull: "enabled"

secret:
  # IMPORTANT: Change this in production!
  executorSecret: "CHANGE-THIS-IN-PRODUCTION"

resources:
  limits:
    cpu: 2000m
    memory: 4Gi
  requests:
    cpu: 1000m
    memory: 2Gi

autoscaling:
  enabled: true
  minReplicas: 3
  maxReplicas: 20
  targetCPUUtilizationPercentage: 70
  targetMemoryUtilizationPercentage: 80

persistence:
  emptyDir: false
  storageClass: "fast-ssd"
  size: 50Gi

# Shared storage for production - requires ReadWriteMany storage class
# Examples: NFS, EFS (AWS), Azure Files, GCP Filestore
sharedStorage:
  enabled: true
  storageClass: "nfs-storage"  # Change to your RWX storage class
  accessMode: ReadWriteMany
  size: 100Gi

podDisruptionBudget:
  enabled: true
  minAvailable: 2

ingress:
  enabled: true
  className: "nginx"
  annotations:
    cert-manager.io/cluster-issuer: letsencrypt-prod
    nginx.ingress.kubernetes.io/rate-limit: "100"
  hosts:
    - host: executor.example.com
      paths:
        - path: /
          pathType: Prefix
  tls:
    - secretName: executor-tls
      hosts:
        - executor.example.com

# Node affinity for production workloads
affinity:
  podAntiAffinity:
    preferredDuringSchedulingIgnoredDuringExecution:
      - weight: 100
        podAffinityTerm:
          labelSelector:
            matchExpressions:
              - key: app.kubernetes.io/name
                operator: In
                values:
                  - openruntimes-executor
          topologyKey: kubernetes.io/hostname
