# WARNING!
# This is a development version of the docker-compose.yml file.
# Avoid using this file in your production environment.
# We're exposing here sensitive ports and mounting code volumes for rapid development and debugging of the server stack.

x-logging: &x-logging
  logging:
    driver: 'json-file'
    options:
      max-file: '5'
      max-size: '10m'

version: '3'

services:
  openruntimes-executor:
    container_name: openruntimes-executor
    hostname: exc1
    <<: *x-logging
    stop_signal: SIGINT
    build:
      context: .
    networks:
      runtimes:
    ports:
      - 9900:80
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
      - ./app:/usr/local/app:rw
      - ./src:/usr/local/src:rw
      - openruntimes-builds:/storage/builds:rw
      - openruntimes-functions:/storage/functions:rw
      - /tmp:/tmp:rw
      - ./tests/resources/functions:/storage/functions:rw
    environment:
      - OPEN_RUNTIMES_EXECUTOR_ENV
      - OPEN_RUNTIMES_EXECUTOR_RUNTIMES
      - OPEN_RUNTIMES_STORAGE_CONNECTION
      - OPEN_RUNTIMES_EXECUTOR_MAX_TIMEOUT
      - OPEN_RUNTIMES_EXECUTOR_BUILD_TIMEOUT
      - OPEN_RUNTIMES_EXECUTOR_CPUS
      - OPEN_RUNTIMES_EXECUTOR_MEMORY
      - OPEN_RUNTIMES_EXECUTOR_MEMORY_SWAP
      - OPEN_RUNTIMES_EXECUTOR_INACTIVE_TRESHOLD
      - OPEN_RUNTIMES_EXECUTOR_NETWORK
      - OPEN_RUNTIMES_EXECUTOR_SECRET
      - OPEN_RUNTIMES_EXECUTOR_LOGGING_PROVIDER
      - OPEN_RUNTIMES_EXECUTOR_LOGGING_CONFIG
      - OPEN_RUNTIMES_EXECUTOR_DOCKER_HUB_USERNAME
      - OPEN_RUNTIMES_EXECUTOR_DOCKER_HUB_PASSWORD

networks:
  runtimes:

volumes:
  openruntimes-builds:
  openruntimes-functions: