services:
  openruntimes-executor:
    hostname: executor
    build:
      context: .
    networks:
      - runtimes
    ports:
      - 9900:80
    healthcheck:
      test: ["CMD", "curl", "-sf", "http://localhost:80/v1/health"]
      interval: 10s
      timeout: 5s
      retries: 12
      start_period: 120s
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
      - openruntimes-builds:/storage/builds:rw
      - openruntimes-functions:/storage/functions:rw
      - /tmp:/tmp:rw
    environment:
      - OPR_EXECUTOR_ENV
      - OPR_EXECUTOR_IMAGES
      - OPR_EXECUTOR_CONNECTION_STORAGE
      - OPR_EXECUTOR_INACTIVE_THRESHOLD
      - OPR_EXECUTOR_MAINTENANCE_INTERVAL
      - OPR_EXECUTOR_NETWORK
      - OPR_EXECUTOR_SECRET
      - OPR_EXECUTOR_DOCKER_HUB_USERNAME
      - OPR_EXECUTOR_DOCKER_HUB_PASSWORD
      - OPR_EXECUTOR_RUNTIME_VERSIONS
      - OPR_EXECUTOR_RETRY_ATTEMPTS
      - OPR_EXECUTOR_RETRY_DELAY_MS
      - OPR_EXECUTOR_IMAGE_PULL

volumes:
  openruntimes-builds:
  openruntimes-functions:

networks:
  runtimes:
